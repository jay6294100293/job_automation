{% extends 'dashboard/../base_dashboard.html' %}

{% block title %}{{ document.get_document_type_display }} Preview - Job Automation{% endblock %}

{% block extra_css %}
<style>
    /* Document preview specific styles */
    .preview-header {
        margin-bottom: var(--space-xl);
        animation: slideUp 0.5s ease forwards;
    }

    .preview-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--space-xs);
        letter-spacing: -0.025em;
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .preview-subtitle {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: var(--space-lg);
    }

    .breadcrumb {
        background: none;
        padding: 0;
        margin-bottom: var(--space-md);
        font-size: 0.8125rem;
    }

    .breadcrumb-item {
        display: flex;
        align-items: center;
    }

    .breadcrumb-item + .breadcrumb-item::before {
        content: ">";
        color: var(--text-tertiary);
        margin: 0 var(--space-sm);
    }

    .breadcrumb-item a {
        color: var(--accent-primary);
        text-decoration: none;
        transition: color var(--transition-normal);
    }

    .breadcrumb-item a:hover {
        color: var(--accent-hover);
        text-decoration: underline;
    }

    .breadcrumb-item.active {
        color: var(--text-secondary);
    }

    .header-actions {
        display: flex;
        gap: var(--space-sm);
        flex-wrap: wrap;
    }

    /* Document Content Area */
    .document-preview-container {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: var(--space-xl);
        margin-bottom: var(--space-xl);
    }

    .document-content-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        overflow: hidden;
        transition: all var(--transition-slow);
    }

    .document-content-card:hover {
        box-shadow: var(--shadow-lg);
    }

    .document-preview {
        max-height: 800px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--border-secondary) var(--bg-tertiary);
    }

    .document-preview::-webkit-scrollbar {
        width: 8px;
    }

    .document-preview::-webkit-scrollbar-track {
        background: var(--bg-tertiary);
        border-radius: 4px;
    }

    .document-preview::-webkit-scrollbar-thumb {
        background: var(--border-secondary);
        border-radius: 4px;
    }

    .document-preview::-webkit-scrollbar-thumb:hover {
        background: var(--text-tertiary);
    }

    .document-content {
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.875rem;
        line-height: 1.6;
        background: var(--bg-tertiary);
        padding: var(--space-xl);
        border-radius: var(--radius-md);
        border: 1px solid var(--border-primary);
        color: var(--text-primary);
    }

    /* Document Type Specific Styles */
    .pdf-preview {
        background: var(--bg-secondary);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-md);
        padding: var(--space-lg);
    }

    .pdf-content {
        max-height: 600px;
        overflow-y: auto;
    }

    .email-templates .email-subject {
        background: linear-gradient(135deg, var(--info-500) 0%, var(--info-600) 100%);
        color: white;
        padding: var(--space-md);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-md);
        font-weight: 600;
        border-left: 4px solid var(--info-600);
    }

    .email-templates .email-body {
        background: var(--info-50);
        border: 1px solid var(--info-500);
        border-left: 4px solid var(--info-500);
        padding: var(--space-lg);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-lg);
        color: var(--text-primary);
    }

    .linkedin-messages .linkedin-header {
        background: linear-gradient(135deg, #0a66c2 0%, #004182 100%);
        color: white;
        padding: var(--space-md);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-md);
        font-weight: 600;
        border-left: 4px solid #004182;
    }

    .linkedin-messages .linkedin-content {
        background: rgba(10, 102, 194, 0.1);
        border: 1px solid #0a66c2;
        border-left: 4px solid #0a66c2;
        padding: var(--space-lg);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-lg);
        color: var(--text-primary);
    }

    .video-script .script-content {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        background: var(--gray-900);
        color: #f8f9fa;
        padding: var(--space-xl);
        border-radius: var(--radius-md);
        border: 1px solid var(--gray-700);
    }

    .video-script .script-content pre {
        color: #f8f9fa;
        margin: 0;
    }

    /* Sidebar Styles */
    .sidebar-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        overflow: hidden;
        margin-bottom: var(--space-lg);
        transition: all var(--transition-slow);
    }

    .sidebar-card:hover {
        box-shadow: var(--shadow-lg);
        transform: translateY(-2px);
    }

    .sidebar-card-header {
        padding: var(--space-md) var(--space-lg);
        border-bottom: 1px solid var(--border-primary);
        font-size: 0.9375rem;
        font-weight: 600;
        color: white;
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .sidebar-card-header.info {
        background: linear-gradient(135deg, var(--info-500) 0%, var(--info-600) 100%);
    }

    .sidebar-card-header.success {
        background: linear-gradient(135deg, var(--success-500) 0%, var(--success-600) 100%);
    }

    .sidebar-card-header.secondary {
        background: linear-gradient(135deg, var(--gray-600) 0%, var(--gray-700) 100%);
    }

    .sidebar-card-body {
        padding: var(--space-lg);
    }

    .info-item {
        padding: var(--space-md);
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        border-left: 3px solid var(--accent-primary);
        margin-bottom: var(--space-md);
        transition: all var(--transition-normal);
    }

    .info-item:hover {
        background: var(--accent-light);
        border-left-color: var(--accent-hover);
    }

    .info-item:last-child {
        margin-bottom: 0;
    }

    .info-item strong {
        display: block;
        font-size: 0.8125rem;
        font-weight: 600;
        color: var(--text-secondary);
        margin-bottom: var(--space-xs);
    }

    .info-item p {
        margin: 0;
        font-size: 0.875rem;
        color: var(--text-primary);
        font-weight: 500;
    }

    .info-item a {
        color: var(--accent-primary);
        text-decoration: none;
        transition: color var(--transition-normal);
    }

    .info-item a:hover {
        color: var(--accent-hover);
        text-decoration: underline;
    }

    .quick-actions {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
    }

    .action-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-sm);
        padding: var(--space-sm) var(--space-md);
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        font-weight: 500;
        text-decoration: none;
        transition: all var(--transition-normal);
        border: 1px solid transparent;
        cursor: pointer;
        background: none;
        width: 100%;
    }

    .action-btn.success {
        background: var(--success-50);
        color: var(--success-500);
        border-color: var(--success-500);
    }

    .action-btn.success:hover {
        background: var(--success-500);
        color: white;
        text-decoration: none;
        transform: translateY(-1px);
    }

    .action-btn.primary {
        background: var(--accent-light);
        color: var(--accent-primary);
        border-color: var(--accent-primary);
    }

    .action-btn.primary:hover {
        background: var(--accent-primary);
        color: white;
        text-decoration: none;
        transform: translateY(-1px);
    }

    .action-btn.info {
        background: var(--info-50);
        color: var(--info-500);
        border-color: var(--info-500);
    }

    .action-btn.info:hover {
        background: var(--info-500);
        color: white;
        text-decoration: none;
        transform: translateY(-1px);
    }

    .action-btn.warning {
        background: var(--warning-50);
        color: var(--warning-500);
        border-color: var(--warning-500);
    }

    .action-btn.warning:hover {
        background: var(--warning-500);
        color: white;
        text-decoration: none;
        transform: translateY(-1px);
    }

    .action-btn.danger {
        background: var(--danger-50);
        color: var(--danger-500);
        border-color: var(--danger-500);
    }

    .action-btn.danger:hover {
        background: var(--danger-500);
        color: white;
        text-decoration: none;
        transform: translateY(-1px);
    }

    /* Related Documents */
    .related-doc-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-md);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-sm);
        transition: all var(--transition-normal);
        background: var(--bg-tertiary);
    }

    .related-doc-item:hover {
        background: var(--accent-light);
        border-color: var(--accent-primary);
        transform: translateX(4px);
    }

    .related-doc-item:last-child {
        margin-bottom: 0;
    }

    .related-doc-info {
        flex: 1;
    }

    .related-doc-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-xs);
    }

    .related-doc-date {
        font-size: 0.75rem;
        color: var(--text-secondary);
    }

    .related-doc-actions {
        display: flex;
        gap: var(--space-xs);
    }

    .doc-action-btn {
        padding: 0.25rem 0.5rem;
        border-radius: var(--radius-sm);
        font-size: 0.75rem;
        border: 1px solid transparent;
        background: none;
        cursor: pointer;
        transition: all var(--transition-normal);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .doc-action-btn.primary {
        color: var(--accent-primary);
        border-color: var(--accent-primary);
    }

    .doc-action-btn.primary:hover {
        background: var(--accent-primary);
        color: white;
        text-decoration: none;
    }

    .doc-action-btn.success {
        color: var(--success-500);
        border-color: var(--success-500);
    }

    .doc-action-btn.success:hover {
        background: var(--success-500);
        color: white;
        text-decoration: none;
    }

    /* Print Styles */
    @media print {
        .preview-header,
        .header-actions,
        .sidebar-card,
        .breadcrumb {
            display: none !important;
        }

        .document-preview-container {
            grid-template-columns: 1fr !important;
        }

        .document-content-card {
            box-shadow: none !important;
            border: none !important;
        }

        .document-content {
            background: white !important;
            border: none !important;
            box-shadow: none !important;
            color: black !important;
        }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .document-preview-container {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .preview-title {
            font-size: 1.5rem;
        }

        .header-actions {
            width: 100%;
        }

        .header-actions .btn {
            flex: 1;
            font-size: 0.8125rem;
        }

        .document-content {
            font-size: 0.8125rem;
            padding: var(--space-md);
        }

        .quick-actions {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 480px) {
        .header-actions {
            flex-direction: column;
        }

        .document-preview {
            max-height: 500px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Document Preview Header -->
<div class="preview-header">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'dashboard:dashboard' %}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{% url 'documents:list' %}">Documents</a></li>
            <li class="breadcrumb-item active">{{ document.get_document_type_display }}</li>
        </ol>
    </nav>

    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-lg);">
        <div>
            <h1 class="preview-title">
                <i class="fas fa-file-alt"></i>
                {{ document.get_document_type_display }}
            </h1>
            <p class="preview-subtitle">
                For {{ document.application.job_title }} at {{ document.application.company_name }}
            </p>
        </div>
        <div class="header-actions">
            <a href="{% url 'documents:download' document.pk %}" class="btn btn-success">
                <i class="fas fa-download"></i> Download
            </a>
            <button class="btn btn-warning" onclick="regenerateDocument()">
                <i class="fas fa-sync"></i> Regenerate
            </button>
            <button class="btn btn-secondary" onclick="deleteDocument()">
                <i class="fas fa-trash"></i> Delete
            </button>
        </div>
    </div>
</div>

<!-- Document Content Grid -->
<div class="document-preview-container">
    <!-- Main Document Content -->
    <div class="document-content-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-eye"></i>
                Document Preview
            </h3>
        </div>
        <div class="card-body">
            <div class="document-preview">
                {% if document.document_type in 'resume,cover_letter,company_research,skills_analysis' %}
                    <!-- PDF-type documents -->
                    <div class="pdf-preview">
                        <div class="pdf-content">
                            <pre class="document-content">{{ file_content|linebreaks }}</pre>
                        </div>
                    </div>
                {% elif document.document_type == 'email_templates' %}
                    <!-- Email templates -->
                    <div class="email-templates">
                        {% for line in file_content|linebreaksbr %}
                            {% if 'Subject:' in line %}
                                <div class="email-subject">
                                    <strong>{{ line }}</strong>
                                </div>
                            {% elif line.strip %}
                                <div class="email-body">
                                    {{ line|safe }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% elif document.document_type == 'linkedin_messages' %}
                    <!-- LinkedIn messages -->
                    <div class="linkedin-messages">
                        {% for line in file_content|linebreaksbr %}
                            {% if 'Message:' in line or 'Subject:' in line %}
                                <div class="linkedin-header">
                                    <strong>{{ line }}</strong>
                                </div>
                            {% elif line.strip %}
                                <div class="linkedin-content">
                                    {{ line|safe }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% elif document.document_type == 'video_script' %}
                    <!-- Video script -->
                    <div class="video-script">
                        <div class="script-content">
                            <pre>{{ file_content }}</pre>
                        </div>
                    </div>
                {% else %}
                    <!-- Default text content -->
                    <div class="text-content">
                        <pre class="document-content">{{ file_content|linebreaks }}</pre>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar-content">
        <!-- Document Information -->
        <div class="sidebar-card">
            <div class="sidebar-card-header info">
                <i class="fas fa-info-circle"></i>
                Document Information
            </div>
            <div class="sidebar-card-body">
                <div class="info-item">
                    <strong>Document Type:</strong>
                    <p>{{ document.get_document_type_display }}</p>
                </div>
                <div class="info-item">
                    <strong>Generated:</strong>
                    <p>{{ document.generated_at|date:"F d, Y H:i" }}</p>
                </div>
                <div class="info-item">
                    <strong>File Size:</strong>
                    <p>
                        {% if document.file_size %}
                            {{ document.file_size|filesizeformat }}
                        {% else %}
                            N/A
                        {% endif %}
                    </p>
                </div>
                <div class="info-item">
                    <strong>Job Application:</strong>
                    <p>
                        <a href="{% url 'jobs:application_detail' document.application.pk %}">
                            {{ document.application.job_title }}
                        </a>
                    </p>
                </div>
                <div class="info-item">
                    <strong>Company:</strong>
                    <p>{{ document.application.company_name }}</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="sidebar-card">
            <div class="sidebar-card-header success">
                <i class="fas fa-bolt"></i>
                Quick Actions
            </div>
            <div class="sidebar-card-body">
                <div class="quick-actions">
                    <a href="{% url 'documents:download' document.pk %}" class="action-btn success">
                        <i class="fas fa-download"></i> Download Document
                    </a>
                    <button class="action-btn primary" onclick="copyContent()">
                        <i class="fas fa-copy"></i> Copy to Clipboard
                    </button>
                    <button class="action-btn info" onclick="printDocument()">
                        <i class="fas fa-print"></i> Print Document
                    </button>
                    <button class="action-btn warning" onclick="regenerateDocument()">
                        <i class="fas fa-sync"></i> Regenerate
                    </button>
                </div>
            </div>
        </div>

        <!-- Related Documents -->
        {% if related_documents %}
        <div class="sidebar-card">
            <div class="sidebar-card-header secondary">
                <i class="fas fa-link"></i>
                Related Documents
            </div>
            <div class="sidebar-card-body">
                {% for related_doc in related_documents %}
                <div class="related-doc-item">
                    <div class="related-doc-info">
                        <div class="related-doc-title">{{ related_doc.get_document_type_display }}</div>
                        <div class="related-doc-date">{{ related_doc.generated_at|date:"M d, Y" }}</div>
                    </div>
                    <div class="related-doc-actions">
                        <a href="{% url 'documents:preview' related_doc.pk %}" class="doc-action-btn primary">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{% url 'documents:download' related_doc.pk %}" class="doc-action-btn success">
                            <i class="fas fa-download"></i>
                        </a>
                    </div>
                </div>
                {% endfor %}

                <div style="margin-top: var(--space-lg);">
                    <a href="{% url 'documents:application_documents' document.application.pk %}" class="action-btn primary" style="font-size: 0.8125rem;">
                        View All Documents for This Job
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyContent() {
    const content = document.querySelector('.document-content');
    if (content) {
        const text = content.textContent || content.innerText;
        navigator.clipboard.writeText(text).then(() => {
            dashboard.showNotification('Content copied to clipboard!', 'success');
        }).catch(err => {
            console.error('Failed to copy: ', err);
            dashboard.showNotification('Failed to copy content to clipboard', 'error');
        });
    }
}

function printDocument() {
    window.print();
}

function regenerateDocument() {
    if (confirm('Regenerate this document? This will create a new version and replace the current one.')) {
        dashboard.showNotification('Regenerating document...', 'info');

        fetch('{% url "documents:regenerate" document.pk %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                dashboard.showNotification('Document regeneration started! You will be notified when complete.', 'success');
                setTimeout(() => location.reload(), 3000);
            } else {
                dashboard.showNotification('Failed to regenerate document', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            dashboard.showNotification('An error occurred while regenerating document', 'error');
        });
    }
}

function deleteDocument() {
    if (confirm('Are you sure you want to delete this document? This action cannot be undone.')) {
        dashboard.showNotification('Deleting document...', 'info');

        fetch('{% url "documents:delete" document.pk %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                dashboard.showNotification('Document deleted successfully!', 'success');
                setTimeout(() => {
                    window.location.href = '{% url "documents:list" %}';
                }, 2000);
            } else {
                dashboard.showNotification('Failed to delete document', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            dashboard.showNotification('An error occurred while deleting document', 'error');
        });
    }
}

// Get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Auto-refresh content if document is being regenerated
let refreshInterval;

function checkDocumentStatus() {
    // This would check if the document is being regenerated
    // and refresh the content when complete
    fetch(`{% url 'api:document_status' document.pk %}`, {
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'completed' && data.updated) {
            dashboard.showNotification('Document has been updated!', 'success');
            setTimeout(() => location.reload(), 1000);
        }
    })
    .catch(error => {
        console.error('Status check error:', error);
    });
}

// Start checking status every 30 seconds
refreshInterval = setInterval(checkDocumentStatus, 30000);

// Clean up interval when page unloads
window.addEventListener('beforeunload', function() {
    if (refreshInterval) {
        clearInterval(refreshInterval);
    }
});

// Smooth scrolling for long documents
document.addEventListener('DOMContentLoaded', function() {
    const preview = document.querySelector('.document-preview');
    if (preview) {
        // Add smooth scrolling behavior
        preview.style.scrollBehavior = 'smooth';

        // Add scroll to top button for long documents
        if (preview.scrollHeight > preview.clientHeight) {
            const scrollTopBtn = document.createElement('button');
            scrollTopBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
            scrollTopBtn.className = 'btn btn-sm btn-primary';
            scrollTopBtn.style.cssText = `
                position: fixed;
                bottom: 2rem;
                right: 2rem;
                z-index: 1000;
                border-radius: 50%;
                width: 44px;
                height: 44px;
                display: none;
                box-shadow: var(--shadow-lg);
            `;

            scrollTopBtn.addEventListener('click', () => {
                preview.scrollTo({ top: 0, behavior: 'smooth' });
            });

            preview.addEventListener('scroll', () => {
                if (preview.scrollTop > 200) {
                    scrollTopBtn.style.display = 'flex';
                } else {
                    scrollTopBtn.style.display = 'none';
                }
            });

            document.body.appendChild(scrollTopBtn);
        }
    }
});
</script>
{% endblock %}

{#{% extends 'base.html' %}#}
{#{% load static %}#}
{##}
{#{% block title %}{{ document.get_document_type_display }} Preview - Job Automation{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container-fluid">#}
{#    <!-- Header -->#}
{#    <div class="row mb-4">#}
{#        <div class="col-12">#}
{#            <div class="d-flex justify-content-between align-items-center">#}
{#                <div>#}
{#                    <nav aria-label="breadcrumb">#}
{#                        <ol class="breadcrumb">#}
{#                            <li class="breadcrumb-item"><a href="{% url 'dashboard:dashboard' %}">Dashboard</a></li>#}
{#                            <li class="breadcrumb-item"><a href="{% url 'documents:list' %}">Documents</a></li>#}
{#                            <li class="breadcrumb-item active">{{ document.get_document_type_display }}</li>#}
{#                        </ol>#}
{#                    </nav>#}
{#                    <h2 class="display-6 fw-bold text-primary mb-0">#}
{#                        <i class="fas fa-file-alt"></i> {{ document.get_document_type_display }}#}
{#                    </h2>#}
{#                    <p class="text-muted">#}
{#                        For {{ document.application.job_title }} at {{ document.application.company_name }}#}
{#                    </p>#}
{#                </div>#}
{#                <div>#}
{#                    <div class="btn-group" role="group">#}
{#                        <a href="{% url 'documents:download' document.pk %}" class="btn btn-success">#}
{#                            <i class="fas fa-download"></i> Download#}
{#                        </a>#}
{#                        <button class="btn btn-warning" onclick="regenerateDocument()">#}
{#                            <i class="fas fa-sync"></i> Regenerate#}
{#                        </button>#}
{#                        <button class="btn btn-danger" onclick="deleteDocument()">#}
{#                            <i class="fas fa-trash"></i> Delete#}
{#                        </button>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="row">#}
{#        <!-- Document Content -->#}
{#        <div class="col-lg-8">#}
{#            <div class="card shadow-sm">#}
{#                <div class="card-header bg-primary text-white">#}
{#                    <h5 class="mb-0">#}
{#                        <i class="fas fa-eye"></i> Document Preview#}
{#                    </h5>#}
{#                </div>#}
{#                <div class="card-body">#}
{#                    <div class="document-preview">#}
{#                        {% if document.document_type in 'resume,cover_letter,company_research,skills_analysis' %}#}
{#                            <!-- PDF-type documents -->#}
{#                            <div class="pdf-preview bg-light p-4 border rounded">#}
{#                                <div class="pdf-content">#}
{#                                    <pre class="document-content">{{ file_content|linebreaks }}</pre>#}
{#                                </div>#}
{#                            </div>#}
{#                        {% elif document.document_type == 'email_templates' %}#}
{#                            <!-- Email templates -->#}
{#                            <div class="email-templates">#}
{#                                {% for line in file_content|linebreaksbr %}#}
{#                                    {% if 'Subject:' in line %}#}
{#                                        <div class="email-subject bg-info text-white p-2 rounded mb-2">#}
{#                                            <strong>{{ line }}</strong>#}
{#                                        </div>#}
{#                                    {% elif line.strip %}#}
{#                                        <div class="email-body mb-3 p-3 border-left border-primary">#}
{#                                            {{ line|safe }}#}
{#                                        </div>#}
{#                                    {% endif %}#}
{#                                {% endfor %}#}
{#                            </div>#}
{#                        {% elif document.document_type == 'linkedin_messages' %}#}
{#                            <!-- LinkedIn messages -->#}
{#                            <div class="linkedin-messages">#}
{#                                {% for line in file_content|linebreaksbr %}#}
{#                                    {% if 'Message:' in line or 'Subject:' in line %}#}
{#                                        <div class="linkedin-header bg-primary text-white p-2 rounded mb-2">#}
{#                                            <strong>{{ line }}</strong>#}
{#                                        </div>#}
{#                                    {% elif line.strip %}#}
{#                                        <div class="linkedin-content mb-3 p-3 bg-light rounded">#}
{#                                            {{ line|safe }}#}
{#                                        </div>#}
{#                                    {% endif %}#}
{#                                {% endfor %}#}
{#                            </div>#}
{#                        {% elif document.document_type == 'video_script' %}#}
{#                            <!-- Video script -->#}
{#                            <div class="video-script">#}
{#                                <div class="script-content p-4 bg-dark text-light rounded">#}
{#                                    <pre class="text-light">{{ file_content }}</pre>#}
{#                                </div>#}
{#                            </div>#}
{#                        {% else %}#}
{#                            <!-- Default text content -->#}
{#                            <div class="text-content">#}
{#                                <pre class="document-content">{{ file_content|linebreaks }}</pre>#}
{#                            </div>#}
{#                        {% endif %}#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Sidebar -->#}
{#        <div class="col-lg-4">#}
{#            <!-- Document Info -->#}
{#            <div class="card shadow-sm mb-4">#}
{#                <div class="card-header bg-info text-white">#}
{#                    <h6 class="mb-0">#}
{#                        <i class="fas fa-info-circle"></i> Document Information#}
{#                    </h6>#}
{#                </div>#}
{#                <div class="card-body">#}
{#                    <div class="info-item mb-3">#}
{#                        <strong>Document Type:</strong>#}
{#                        <p class="mb-0">{{ document.get_document_type_display }}</p>#}
{#                    </div>#}
{#                    <div class="info-item mb-3">#}
{#                        <strong>Generated:</strong>#}
{#                        <p class="mb-0">{{ document.generated_at|date:"F d, Y H:i" }}</p>#}
{#                    </div>#}
{#                    <div class="info-item mb-3">#}
{#                        <strong>File Size:</strong>#}
{#                        <p class="mb-0">#}
{#                            {% if document.file_size %}#}
{#                                {{ document.file_size|filesizeformat }}#}
{#                            {% else %}#}
{#                                N/A#}
{#                            {% endif %}#}
{#                        </p>#}
{#                    </div>#}
{#                    <div class="info-item mb-3">#}
{#                        <strong>Job Application:</strong>#}
{#                        <p class="mb-0">#}
{#                            <a href="{% url 'jobs:application_detail' document.application.pk %}" class="text-decoration-none">#}
{#                                {{ document.application.job_title }}#}
{#                            </a>#}
{#                        </p>#}
{#                    </div>#}
{#                    <div class="info-item">#}
{#                        <strong>Company:</strong>#}
{#                        <p class="mb-0">{{ document.application.company_name }}</p>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <!-- Quick Actions -->#}
{#            <div class="card shadow-sm mb-4">#}
{#                <div class="card-header bg-success text-white">#}
{#                    <h6 class="mb-0">#}
{#                        <i class="fas fa-bolt"></i> Quick Actions#}
{#                    </h6>#}
{#                </div>#}
{#                <div class="card-body">#}
{#                    <div class="d-grid gap-2">#}
{#                        <a href="{% url 'documents:download' document.pk %}" class="btn btn-success">#}
{#                            <i class="fas fa-download"></i> Download Document#}
{#                        </a>#}
{#                        <button class="btn btn-primary" onclick="copyContent()">#}
{#                            <i class="fas fa-copy"></i> Copy to Clipboard#}
{#                        </button>#}
{#                        <button class="btn btn-info" onclick="printDocument()">#}
{#                            <i class="fas fa-print"></i> Print Document#}
{#                        </button>#}
{#                        <button class="btn btn-warning" onclick="regenerateDocument()">#}
{#                            <i class="fas fa-sync"></i> Regenerate#}
{#                        </button>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <!-- Related Documents -->#}
{#            {% if related_documents %}#}
{#            <div class="card shadow-sm">#}
{#                <div class="card-header bg-secondary text-white">#}
{#                    <h6 class="mb-0">#}
{#                        <i class="fas fa-link"></i> Related Documents#}
{#                    </h6>#}
{#                </div>#}
{#                <div class="card-body">#}
{#                    {% for related_doc in related_documents %}#}
{#                    <div class="related-doc-item d-flex justify-content-between align-items-center mb-2 p-2 border rounded">#}
{#                        <div>#}
{#                            <strong>{{ related_doc.get_document_type_display }}</strong>#}
{#                            <br><small class="text-muted">{{ related_doc.generated_at|date:"M d, Y" }}</small>#}
{#                        </div>#}
{#                        <div class="btn-group btn-group-sm">#}
{#                            <a href="{% url 'documents:preview' related_doc.pk %}" class="btn btn-outline-primary btn-sm">#}
{#                                <i class="fas fa-eye"></i>#}
{#                            </a>#}
{#                            <a href="{% url 'documents:download' related_doc.pk %}" class="btn btn-outline-success btn-sm">#}
{#                                <i class="fas fa-download"></i>#}
{#                            </a>#}
{#                        </div>#}
{#                    </div>#}
{#                    {% endfor %}#}
{##}
{#                    <div class="mt-3">#}
{#                        <a href="{% url 'documents:application_documents' document.application.pk %}" class="btn btn-outline-primary btn-sm w-100">#}
{#                            View All Documents for This Job#}
{#                        </a>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#            {% endif %}#}
{#        </div>#}
{#    </div>#}
{#</div>#}
{#{% endblock %}#}
{##}
{#{% block extra_css %}#}
{#<style>#}
{#.document-preview {#}
{#    max-height: 800px;#}
{#    overflow-y: auto;#}
{#}#}
{##}
{#.document-content {#}
{#    white-space: pre-wrap;#}
{#    word-wrap: break-word;#}
{#    font-family: 'Courier New', monospace;#}
{#    font-size: 0.9rem;#}
{#    line-height: 1.5;#}
{#    background-color: #f8f9fa;#}
{#    padding: 20px;#}
{#    border-radius: 8px;#}
{#    border: 1px solid #dee2e6;#}
{#}#}
{##}
{#.pdf-preview {#}
{#    background-color: white;#}
{#    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);#}
{#    border: 1px solid #dee2e6;#}
{#}#}
{##}
{#.pdf-content {#}
{#    max-height: 600px;#}
{#    overflow-y: auto;#}
{#}#}
{##}
{#.email-subject {#}
{#    font-weight: bold;#}
{#    border-left: 4px solid #0dcaf0;#}
{#}#}
{##}
{#.email-body {#}
{#    background-color: #f8f9fa;#}
{#    border-left: 4px solid #0d6efd;#}
{#}#}
{##}
{#.linkedin-header {#}
{#    border-left: 4px solid #0a66c2;#}
{#}#}
{##}
{#.linkedin-content {#}
{#    border-left: 4px solid #0a66c2;#}
{#}#}
{##}
{#.script-content {#}
{#    font-family: 'Courier New', monospace;#}
{#    background-color: #212529 !important;#}
{#    color: #f8f9fa !important;#}
{#}#}
{##}
{#.info-item {#}
{#    padding: 10px;#}
{#    background-color: #f8f9fa;#}
{#    border-radius: 5px;#}
{#    border-left: 3px solid #0d6efd;#}
{#}#}
{##}
{#.related-doc-item {#}
{#    transition: background-color 0.3s ease;#}
{#}#}
{##}
{#.related-doc-item:hover {#}
{#    background-color: #f8f9fa;#}
{#}#}
{##}
{#@media print {#}
{#    .card-header,#}
{#    .btn,#}
{#    .breadcrumb,#}
{#    .col-lg-4 {#}
{#        display: none !important;#}
{#    }#}
{##}
{#    .col-lg-8 {#}
{#        width: 100% !important;#}
{#    }#}
{##}
{#    .document-content {#}
{#        background-color: white !important;#}
{#        border: none !important;#}
{#        box-shadow: none !important;#}
{#    }#}
{#}#}
{##}
{#@media (max-width: 768px) {#}
{#    .document-content {#}
{#        font-size: 0.8rem;#}
{#        padding: 15px;#}
{#    }#}
{##}
{#    .btn-group .btn {#}
{#        font-size: 0.8rem;#}
{#        padding: 0.25rem 0.5rem;#}
{#    }#}
{#}#}
{#</style>#}
{#{% endblock %}#}
{##}
{#{% block extra_js %}#}
{#<script>#}
{#function copyContent() {#}
{#    const content = document.querySelector('.document-content');#}
{#    if (content) {#}
{#        const text = content.textContent || content.innerText;#}
{#        navigator.clipboard.writeText(text).then(() => {#}
{#            Swal.fire({#}
{#                toast: true,#}
{#                position: 'top-end',#}
{#                showConfirmButton: false,#}
{#                timer: 3000,#}
{#                icon: 'success',#}
{#                title: 'Content copied to clipboard!'#}
{#            });#}
{#        }).catch(err => {#}
{#            console.error('Failed to copy: ', err);#}
{#            Swal.fire('Error', 'Failed to copy content to clipboard', 'error');#}
{#        });#}
{#    }#}
{#}#}
{##}
{#function printDocument() {#}
{#    window.print();#}
{#}#}
{##}
{#function regenerateDocument() {#}
{#    Swal.fire({#}
{#        title: 'Regenerate Document?',#}
{#        text: 'This will create a new version of this document. The current version will be replaced.',#}
{#        icon: 'question',#}
{#        showCancelButton: true,#}
{#        confirmButtonText: 'Regenerate',#}
{#        cancelButtonText: 'Cancel'#}
{#    }).then((result) => {#}
{#        if (result.isConfirmed) {#}
{#            // Show loading#}
{#            Swal.fire({#}
{#                title: 'Regenerating Document',#}
{#                text: 'Please wait while we generate a new version...',#}
{#                allowOutsideClick: false,#}
{#                showConfirmButton: false,#}
{#                willOpen: () => {#}
{#                    Swal.showLoading();#}
{#                }#}
{#            });#}
{##}
{#            // Make AJAX request#}
{#            $.post('{% url "documents:regenerate" document.pk %}', {#}
{#                csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val()#}
{#            }).done(function(response) {#}
{#                Swal.fire('Success!', 'Document regeneration started. You will be notified when complete.', 'success')#}
{#                .then(() => {#}
{#                    setTimeout(() => location.reload(), 2000);#}
{#                });#}
{#            }).fail(function() {#}
{#                Swal.fire('Error!', 'Failed to regenerate document.', 'error');#}
{#            });#}
{#        }#}
{#    });#}
{#}#}
{##}
{#function deleteDocument() {#}
{#    Swal.fire({#}
{#        title: 'Delete Document?',#}
{#        text: 'This action cannot be undone. The document will be permanently deleted.',#}
{#        icon: 'warning',#}
{#        showCancelButton: true,#}
{#        confirmButtonColor: '#dc3545',#}
{#        confirmButtonText: 'Delete',#}
{#        cancelButtonText: 'Cancel'#}
{#    }).then((result) => {#}
{#        if (result.isConfirmed) {#}
{#            $.post('{% url "documents:delete" document.pk %}', {#}
{#                csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val()#}
{#            }).done(function(response) {#}
{#                Swal.fire('Deleted!', 'Document has been deleted.', 'success')#}
{#                .then(() => {#}
{#                    window.location.href = '{% url "documents:list" %}';#}
{#                });#}
{#            }).fail(function() {#}
{#                Swal.fire('Error!', 'Failed to delete document.', 'error');#}
{#            });#}
{#        }#}
{#    });#}
{#}#}
{##}
{#// Auto-refresh content if document is being regenerated#}
{#let refreshInterval;#}
{##}
{#function checkDocumentStatus() {#}
{#    // This would check if the document is being regenerated#}
{#    // and refresh the content when complete#}
{#}#}
{##}
{#// Start checking status every 30 seconds#}
{#refreshInterval = setInterval(checkDocumentStatus, 30000);#}
{##}
{#// Clean up interval when page unloads#}
{#window.addEventListener('beforeunload', function() {#}
{#    if (refreshInterval) {#}
{#        clearInterval(refreshInterval);#}
{#    }#}
{#});#}
{#</script>#}
{#{% endblock %}#}