{% extends 'dashboard/../base_dashboard.html' %}
{% load static %}

{% block title %}Job Opportunities - Job Automation{% endblock %}

{% block extra_css %}
<style>
:root {
    --job-gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --job-gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --job-gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --job-gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    --job-gradient-success: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    --job-gradient-warning: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
    --job-gradient-info: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);

    --card-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    --card-shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.15);
    --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Page Header */
.page-header {
    background: var(--job-gradient-1);
    border-radius: 1.5rem;
    padding: 2.5rem;
    margin-bottom: 2rem;
    color: white;
    position: relative;
    overflow: hidden;
}

.page-header::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 200px;
    height: 200px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    transform: translate(50%, -50%);
}

.page-title {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    letter-spacing: -0.02em;
}

.page-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    margin: 0;
}

.view-toggle {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 1rem;
    padding: 0.5rem;
    backdrop-filter: blur(10px);
}

.view-toggle .btn {
    border: none;
    background: transparent;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 0.75rem;
    transition: var(--transition-smooth);
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
}

.view-toggle .btn.active {
    background: rgba(255, 255, 255, 0.25);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.view-toggle .btn:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    text-decoration: none;
}

/* Enhanced Stats Cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stats-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 1.25rem;
    padding: 2rem;
    position: relative;
    overflow: hidden;
    transition: var(--transition-smooth);
    box-shadow: var(--card-shadow);
}

.stats-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--card-gradient);
}

.stats-card:nth-child(1) { --card-gradient: var(--job-gradient-1); }
.stats-card:nth-child(2) { --card-gradient: var(--job-gradient-success); }
.stats-card:nth-child(3) { --card-gradient: var(--job-gradient-warning); }
.stats-card:nth-child(4) { --card-gradient: var(--job-gradient-info); }

.stats-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--card-shadow-hover);
}

.stats-icon {
    width: 60px;
    height: 60px;
    border-radius: 1rem;
    background: var(--card-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    margin-bottom: 1rem;
}

.stats-number {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
    letter-spacing: -0.02em;
}

.stats-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Modern Filter Section */
.filter-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 1.25rem;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: var(--card-shadow);
}

.filter-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1.25rem;
    align-items: end;
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.025em;
}

.modern-select,
.modern-input {
    background: var(--bg-primary);
    border: 2px solid var(--border-primary);
    border-radius: 0.75rem;
    padding: 0.875rem 1rem;
    font-size: 0.9rem;
    color: var(--text-primary);
    transition: var(--transition-smooth);
    height: 48px;
}

.modern-select:focus,
.modern-input:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    background: var(--bg-secondary);
}

.search-group {
    position: relative;
    grid-column: span 2;
}

.search-input {
    padding-right: 3rem;
}

.search-btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--job-gradient-1);
    border: none;
    border-radius: 0.5rem;
    color: white;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-smooth);
}

.search-btn:hover {
    transform: translateY(-50%) scale(1.05);
}

/* Enhanced Bulk Actions */
.bulk-actions {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border: 2px dashed var(--border-primary);
    border-radius: 1rem;
    padding: 1.5rem;
    margin-bottom: 2rem;
    transition: var(--transition-smooth);
}

.bulk-actions.active {
    border-color: var(--accent-primary);
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
}

.bulk-grid {
    display: grid;
    grid-template-columns: auto 1fr auto auto;
    gap: 1.5rem;
    align-items: center;
}

.bulk-select {
    min-width: 200px;
}

.bulk-btn {
    background: var(--job-gradient-1);
    border: none;
    border-radius: 0.75rem;
    color: white;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.bulk-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.bulk-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Modern Job Cards */
.jobs-container {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 1.25rem;
    overflow: hidden;
    box-shadow: var(--card-shadow);
}

.jobs-header {
    background: var(--bg-primary);
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--border-primary);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.jobs-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin: 0;
}

.jobs-count {
    background: var(--job-gradient-1);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.8rem;
    font-weight: 600;
}

.sort-buttons {
    display: flex;
    background: var(--bg-secondary);
    border-radius: 0.75rem;
    padding: 0.25rem;
    gap: 0.25rem;
}

.sort-btn {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.85rem;
    font-weight: 600;
    transition: var(--transition-smooth);
    cursor: pointer;
}

.sort-btn.active {
    background: var(--bg-primary);
    color: var(--accent-primary);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Job Grid and List Layout */
.jobs-grid {
    display: grid;
    gap: 1.5rem;
    padding: 2rem;
}

/* Pipeline View Styles */
.pipeline-view {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    padding: 2rem;
    min-height: 600px;
}

.pipeline-column {
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    border-radius: 1rem;
    padding: 1rem;
    min-height: 500px;
}

.pipeline-header {
    background: var(--job-gradient-1);
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 0.75rem;
    margin-bottom: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.pipeline-count {
    background: rgba(255, 255, 255, 0.2);
    padding: 0.25rem 0.5rem;
    border-radius: 0.5rem;
    font-size: 0.8rem;
}

.pipeline-items {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    min-height: 400px;
}

/* Job Card - Used in both views */
.job-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    border-radius: 1rem;
    padding: 1.75rem;
    transition: var(--transition-smooth);
    position: relative;
    cursor: pointer;
}

.job-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    border-color: var(--accent-primary);
}

.job-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.job-checkbox {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.job-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    line-height: 1.3;
}

.job-title a {
    color: inherit;
    text-decoration: none;
    transition: var(--transition-smooth);
}

.job-title a:hover {
    color: var(--accent-primary);
}

.company-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.company-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-secondary);
}

.company-rating {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.job-meta {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 1.25rem;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: var(--text-tertiary);
}

.meta-icon {
    width: 16px;
    opacity: 0.7;
}

.job-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1.25rem;
}

.job-badge {
    padding: 0.375rem 0.75rem;
    border-radius: 0.5rem;
    font-size: 0.8rem;
    font-weight: 600;
    border: none;
}

.badge-urgent { background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; }
.badge-high { background: linear-gradient(135deg, #feca57, #ff9ff3); color: white; }
.badge-remote { background: linear-gradient(135deg, #48dbfb, #0abde3); color: white; }
.badge-docs { background: linear-gradient(135deg, #1dd1a1, #10ac84); color: white; }
.badge-status { background: var(--bg-tertiary); color: var(--text-primary); }

.match-score {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.25rem;
}

.match-progress {
    flex: 1;
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: 4px;
    overflow: hidden;
}

.match-bar {
    height: 100%;
    background: var(--job-gradient-success);
    border-radius: 4px;
    transition: width 0.3s ease;
}

.match-bar.high { background: var(--job-gradient-success); }
.match-bar.medium { background: var(--job-gradient-warning); }
.match-bar.low { background: var(--job-gradient-2); }

.match-text {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-primary);
    min-width: 45px;
}

.job-actions {
    display: flex;
    gap: 0.75rem;
}

.action-btn {
    flex: 1;
    padding: 0.75rem 1rem;
    border: 2px solid var(--border-primary);
    border-radius: 0.75rem;
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 0.85rem;
    font-weight: 600;
    text-decoration: none;
    text-align: center;
    transition: var(--transition-smooth);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    text-decoration: none;
    color: var(--text-primary);
}

.action-btn.primary {
    background: var(--job-gradient-1);
    border-color: transparent;
    color: white;
}

.action-btn.primary:hover {
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

/* View Toggle Classes */
.view-content {
    display: none;
}

.view-content.active {
    display: block;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
}

.empty-icon {
    width: 120px;
    height: 120px;
    border-radius: 2rem;
    background: var(--job-gradient-1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 2rem;
    font-size: 3rem;
    color: white;
}

.empty-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1rem;
}

.empty-text {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-bottom: 2rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}

.empty-action {
    background: var(--job-gradient-1);
    border: none;
    border-radius: 0.75rem;
    color: white;
    font-size: 1rem;
    font-weight: 600;
    padding: 1rem 2rem;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: var(--transition-smooth);
}

.empty-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    color: white;
    text-decoration: none;
}

/* Responsive Design */
@media (max-width: 768px) {
    .page-header {
        padding: 2rem;
        text-align: center;
    }

    .page-title {
        font-size: 2rem;
    }

    .filter-grid {
        grid-template-columns: 1fr;
    }

    .search-group {
        grid-column: span 1;
    }

    .bulk-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .jobs-header {
        flex-direction: column;
        gap: 1rem;
    }

    .job-meta {
        grid-template-columns: 1fr;
    }

    .job-actions {
        flex-direction: column;
    }

    .pipeline-view {
        grid-template-columns: 1fr;
    }
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--border-secondary);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-tertiary);
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Modern Page Header -->
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="page-title">
                    <i class="fas fa-briefcase me-3"></i>
                    Job Opportunities
                </h1>
                <p class="page-subtitle">Discover and manage your career opportunities</p>
            </div>
{#            <div class="view-toggle">#}
{#                <button type="button" class="btn view-toggle-btn active" data-view="grid">#}
{#                    <i class="fas fa-th-list me-2"></i>Grid View#}
{#                </button>#}
{#                <button type="button" class="btn view-toggle-btn" data-view="pipeline">#}
{#                    <i class="fas fa-project-diagram me-2"></i>Pipeline#}
{#                </button>#}
{#            </div>#}
        </div>
    </div>

    <!-- Enhanced Stats Grid -->
    <div class="stats-grid">
        <div class="stats-card">
            <div class="stats-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <div class="stats-number">{{ jobs.count|default:0 }}</div>
            <div class="stats-label">Total Jobs</div>
        </div>
        <div class="stats-card">
            <div class="stats-icon">
                <i class="fas fa-paper-plane"></i>
            </div>
            <div class="stats-number">{{ applied_jobs|default:0 }}</div>
            <div class="stats-label">Applied</div>
        </div>
        <div class="stats-card">
            <div class="stats-icon">
                <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stats-number">{{ interviews_count|default:0 }}</div>
            <div class="stats-label">Interviews</div>
        </div>
        <div class="stats-card">
            <div class="stats-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="stats-number">{{ offers_count|default:0 }}</div>
            <div class="stats-label">Offers</div>
        </div>
    </div>

    <!-- Modern Filter Section -->
    <div class="filter-card">
        <h6 class="filter-title">
            <i class="fas fa-filter"></i>
            Filters & Search
        </h6>
        <form method="get" id="filterForm">
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select name="status" class="modern-select">
                        <option value="">All Statuses</option>
                        <option value="discovered" {% if request.GET.status == 'discovered' %}selected{% endif %}>Discovered</option>
                        <option value="applied" {% if request.GET.status == 'applied' %}selected{% endif %}>Applied</option>
                        <option value="responded" {% if request.GET.status == 'responded' %}selected{% endif %}>Responded</option>
                        <option value="interview" {% if request.GET.status == 'interview' %}selected{% endif %}>Interview</option>
                        <option value="offer" {% if request.GET.status == 'offer' %}selected{% endif %}>Offer</option>
                        <option value="hired" {% if request.GET.status == 'hired' %}selected{% endif %}>Hired</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Urgency</label>
                    <select name="urgency" class="modern-select">
                        <option value="">All Levels</option>
                        <option value="urgent" {% if request.GET.urgency == 'urgent' %}selected{% endif %}>Urgent</option>
                        <option value="high" {% if request.GET.urgency == 'high' %}selected{% endif %}>High</option>
                        <option value="medium" {% if request.GET.urgency == 'medium' %}selected{% endif %}>Medium</option>
                        <option value="low" {% if request.GET.urgency == 'low' %}selected{% endif %}>Low</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Work Type</label>
                    <select name="remote" class="modern-select">
                        <option value="">All Types</option>
                        <option value="remote" {% if request.GET.remote == 'remote' %}selected{% endif %}>Remote</option>
                        <option value="hybrid" {% if request.GET.remote == 'hybrid' %}selected{% endif %}>Hybrid</option>
                        <option value="onsite" {% if request.GET.remote == 'onsite' %}selected{% endif %}>On-site</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Date Range</label>
                    <select name="date_range" class="modern-select">
                        <option value="">All Time</option>
                        <option value="today" {% if request.GET.date_range == 'today' %}selected{% endif %}>Today</option>
                        <option value="week" {% if request.GET.date_range == 'week' %}selected{% endif %}>This Week</option>
                        <option value="month" {% if request.GET.date_range == 'month' %}selected{% endif %}>This Month</option>
                    </select>
                </div>
                <div class="filter-group search-group">
                    <label class="filter-label">Search Jobs</label>
                    <div class="position-relative">
                        <input type="text" name="search" class="modern-input search-input"
                               placeholder="Job title, company, or keywords..."
                               value="{{ request.GET.search }}">
                        <button type="submit" class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="filter-group">
                    <label class="filter-label">&nbsp;</label>
                    <a href="{% url 'jobs:job_list' %}" class="action-btn">
                        <i class="fas fa-times"></i>
                        Clear All
                    </a>
                </div>
            </div>
        </form>
    </div>

    <!-- Enhanced Bulk Actions -->
    <div class="bulk-actions" id="bulkActions">
        <form method="post" action="{% url 'jobs:bulk_action' %}" id="bulkForm">
            {% csrf_token %}
            <div class="bulk-grid">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="selectAll">
                    <label class="form-check-label fw-bold" for="selectAll">
                        Select All
                    </label>
                </div>
                <select name="action" class="modern-select bulk-select" id="bulkAction">
                    <option value="">Choose action...</option>
                    <option value="mark_applied">Mark as Applied</option>
                    <option value="send_followup">Send Follow-up</option>
                    <option value="download_docs">Download Documents</option>
                    <option value="update_status">Update Status</option>
                    <option value="export_data">Export Data</option>
                </select>
                <button type="submit" class="bulk-btn" id="executeButton" disabled>
                    <i class="fas fa-play"></i>
                    Execute Action
                </button>
                <span class="text-muted">
                    <span id="selectedCount">0</span> jobs selected
                </span>
            </div>
        </form>
    </div>

    <!-- Modern Jobs Container -->
    <div class="jobs-container">
        <div class="jobs-header">
            <h6 class="jobs-title">
                <i class="fas fa-briefcase"></i>
                Job Applications
                <span class="jobs-count">{{ jobs.count }}</span>
            </h6>
            <div class="sort-buttons">
                <button class="sort-btn {% if request.GET.sort == '-created_at' or not request.GET.sort %}active{% endif %}" data-sort="-created_at">Latest</button>
                <button class="sort-btn {% if request.GET.sort == '-match_percentage' %}active{% endif %}" data-sort="-match_percentage">Best Match</button>
                <button class="sort-btn {% if request.GET.sort == 'company_name' %}active{% endif %}" data-sort="company_name">Company</button>
                <button class="sort-btn {% if request.GET.sort == 'job_title' %}active{% endif %}" data-sort="job_title">Title</button>
            </div>
        </div>

        <!-- Grid View -->
        <div id="gridView" class="view-content active">
            {% if jobs %}
                <div class="jobs-grid">
                    {% for job in jobs %}
                    <div class="job-card" data-job-id="{{ job.id }}">
                        <input type="checkbox" name="selected_jobs" value="{{ job.id }}" class="job-checkbox">

                        <div class="job-card-header">
                            <div class="flex-grow-1">
                                <h3 class="job-title">
                                    <a href="{% url 'jobs:application_detail' job.pk %}">
                                        {{ job.job_title }}
                                    </a>
                                </h3>
                                <div class="company-info">
                                    <span class="company-name">{{ job.company_name }}</span>
                                    {% if job.company_rating %}
                                    <div class="company-rating">
                                        {% for i in "12345" %}
                                            <i class="fas fa-star {% if forloop.counter <= job.company_rating %}text-warning{% else %}text-muted{% endif %} small"></i>
                                        {% endfor %}
                                        <small class="text-muted ms-1">({{ job.company_rating }})</small>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="job-meta">
                            <div class="meta-item">
                                <i class="fas fa-map-marker-alt meta-icon"></i>
                                <span>{{ job.location|default:"Remote" }}</span>
                            </div>
                            {% if job.salary_range %}
                            <div class="meta-item">
                                <i class="fas fa-dollar-sign meta-icon"></i>
                                <span>{{ job.salary_range }}</span>
                            </div>
                            {% endif %}
                            <div class="meta-item">
                                <i class="fas fa-clock meta-icon"></i>
                                <span>{{ job.created_at|timesince }} ago</span>
                            </div>
                            {% if job.remote_option %}
                            <div class="meta-item">
                                <i class="fas fa-laptop meta-icon"></i>
                                <span>{{ job.remote_option|title }}</span>
                            </div>
                            {% endif %}
                        </div>

                        <div class="job-badges">
                            {% if job.urgency_level == 'urgent' %}
                                <span class="job-badge badge-urgent">üî• Urgent</span>
                            {% elif job.urgency_level == 'high' %}
                                <span class="job-badge badge-high">‚ö° High Priority</span>
                            {% endif %}

                            {% if job.remote_option %}
                                <span class="job-badge badge-remote">üè† {{ job.remote_option|title }}</span>
                            {% endif %}

                            {% if job.documents_generated %}
                                <span class="job-badge badge-docs">üìÑ Docs Ready</span>
                            {% endif %}

                            <span class="job-badge badge-status">
                                {{ job.get_application_status_display }}
                            </span>
                        </div>

                        {% if job.match_percentage %}
                        <div class="match-score">
                            <div class="match-progress">
                                <div class="match-bar {% if job.match_percentage >= 80 %}high{% elif job.match_percentage >= 60 %}medium{% else %}low{% endif %}"
                                     style="width: {{ job.match_percentage }}%"></div>
                            </div>
                            <span class="match-text">{{ job.match_percentage }}%</span>
                        </div>
                        {% endif %}

                        <div class="job-actions">
                            {% if job.application_status == 'discovered' %}
                                <button class="action-btn primary" onclick="markAsApplied({{ job.id }})">
                                    <i class="fas fa-paper-plane"></i>
                                    Apply Now
                                </button>
                            {% elif job.application_status == 'applied' %}
                                <button class="action-btn" onclick="sendFollowup({{ job.id }})">
                                    <i class="fas fa-envelope"></i>
                                    Follow Up
                                </button>
                            {% endif %}

                            <a href="{% url 'jobs:application_detail' job.pk %}" class="action-btn">
                                <i class="fas fa-eye"></i>
                                View Details
                            </a>

                            {% if job.job_url %}
                            <a href="{{ job.job_url }}" target="_blank" class="action-btn">
                                <i class="fas fa-external-link-alt"></i>
                                Original Post
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <!-- Enhanced Empty State -->
                <div class="empty-state">
                    {% if request.GET.search or request.GET.status %}
                        <div class="empty-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h4 class="empty-title">No Jobs Found</h4>
                        <p class="empty-text">
                            We couldn't find any jobs matching your current filters.
                            Try adjusting your search criteria or clearing the filters.
                        </p>
                        <a href="{% url 'jobs:job_list' %}" class="empty-action">
                            <i class="fas fa-times"></i>
                            Clear All Filters
                        </a>
                    {% else %}
                        <div class="empty-icon">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <h4 class="empty-title">Ready to Find Your Dream Job?</h4>
                        <p class="empty-text">
                            Start your job search journey and discover amazing opportunities
                            tailored to your skills and preferences.
                        </p>
                        <a href="{% url 'jobs:search_config' %}" class="empty-action">
                            <i class="fas fa-rocket"></i>
                            Start Job Search
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <!-- Pipeline View -->
        <div id="pipelineView" class="view-content">
            {% if jobs %}
                <div class="pipeline-view">
                    <!-- Discovered Column -->
                    <div class="pipeline-column">
                        <div class="pipeline-header">
                            <span><i class="fas fa-search me-2"></i>Discovered</span>
                            <span class="pipeline-count">{{ pipeline.discovered.count|default:0 }}</span>
                        </div>
                        <div class="pipeline-items" data-status="discovered">
                            {% for job in pipeline.discovered %}
                            <div class="job-card pipeline-job-card" data-job-id="{{ job.id }}">
                                <input type="checkbox" name="selected_jobs" value="{{ job.id }}" class="job-checkbox">

                                <h4 class="job-title">
                                    <a href="{% url 'jobs:application_detail' job.pk %}">
                                        {{ job.job_title }}
                                    </a>
                                </h4>

                                <div class="company-info">
                                    <span class="company-name">{{ job.company_name }}</span>
                                </div>

                                <div class="job-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-map-marker-alt meta-icon"></i>
                                        <span>{{ job.location|default:"Remote" }}</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-clock meta-icon"></i>
                                        <span>{{ job.created_at|timesince }} ago</span>
                                    </div>
                                </div>

                                <div class="job-badges">
                                    {% if job.urgency_level == 'urgent' %}
                                        <span class="job-badge badge-urgent">üî• Urgent</span>
                                    {% elif job.urgency_level == 'high' %}
                                        <span class="job-badge badge-high">‚ö° High</span>
                                    {% endif %}
                                    {% if job.remote_option %}
                                        <span class="job-badge badge-remote">{{ job.remote_option|title }}</span>
                                    {% endif %}
                                </div>

                                <div class="job-actions">
                                    <button class="action-btn primary" onclick="markAsApplied({{ job.id }})">
                                        <i class="fas fa-paper-plane"></i>
                                        Apply Now
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Applied Column -->
                    <div class="pipeline-column">
                        <div class="pipeline-header">
                            <span><i class="fas fa-paper-plane me-2"></i>Applied</span>
                            <span class="pipeline-count">{{ pipeline.applied.count|default:0 }}</span>
                        </div>
                        <div class="pipeline-items" data-status="applied">
                            {% for job in pipeline.applied %}
                            <div class="job-card pipeline-job-card" data-job-id="{{ job.id }}">
                                <input type="checkbox" name="selected_jobs" value="{{ job.id }}" class="job-checkbox">

                                <h4 class="job-title">
                                    <a href="{% url 'jobs:application_detail' job.pk %}">
                                        {{ job.job_title }}
                                    </a>
                                </h4>

                                <div class="company-info">
                                    <span class="company-name">{{ job.company_name }}</span>
                                </div>

                                <div class="job-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-calendar meta-icon"></i>
                                        <span>Applied: {{ job.applied_date|date:"M d" }}</span>
                                    </div>
                                </div>

                                <div class="job-actions">
                                    <button class="action-btn" onclick="sendFollowup({{ job.id }})">
                                        <i class="fas fa-envelope"></i>
                                        Follow Up
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Responded Column -->
                    <div class="pipeline-column">
                        <div class="pipeline-header">
                            <span><i class="fas fa-reply me-2"></i>Responded</span>
                            <span class="pipeline-count">{{ pipeline.responded.count|default:0 }}</span>
                        </div>
                        <div class="pipeline-items" data-status="responded">
                            {% for job in pipeline.responded %}
                            <div class="job-card pipeline-job-card" data-job-id="{{ job.id }}">
                                <input type="checkbox" name="selected_jobs" value="{{ job.id }}" class="job-checkbox">

                                <h4 class="job-title">
                                    <a href="{% url 'jobs:application_detail' job.pk %}">
                                        {{ job.job_title }}
                                    </a>
                                </h4>

                                <div class="company-info">
                                    <span class="company-name">{{ job.company_name }}</span>
                                </div>

                                <div class="job-badges">
                                    <span class="job-badge badge-status">Response Received</span>
                                </div>

                                <div class="job-actions">
                                    <a href="{% url 'jobs:application_detail' job.pk %}" class="action-btn primary">
                                        <i class="fas fa-eye"></i>
                                        View Response
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Interview Column -->
                    <div class="pipeline-column">
                        <div class="pipeline-header">
                            <span><i class="fas fa-calendar-check me-2"></i>Interview</span>
                            <span class="pipeline-count">{{ pipeline.interview.count|default:0 }}</span>
                        </div>
                        <div class="pipeline-items" data-status="interview">
                            {% for job in pipeline.interview %}
                            <div class="job-card pipeline-job-card" data-job-id="{{ job.id }}">
                                <input type="checkbox" name="selected_jobs" value="{{ job.id }}" class="job-checkbox">

                                <h4 class="job-title">
                                    <a href="{% url 'jobs:application_detail' job.pk %}">
                                        {{ job.job_title }}
                                    </a>
                                </h4>

                                <div class="company-info">
                                    <span class="company-name">{{ job.company_name }}</span>
                                </div>

                                {% if job.interview_date %}
                                <div class="job-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-clock meta-icon"></i>
                                        <span>{{ job.interview_date|date:"M d, Y" }}</span>
                                    </div>
                                </div>
                                {% endif %}

                                <div class="job-badges">
                                    <span class="job-badge badge-status">Interview Scheduled</span>
                                </div>

                                <div class="job-actions">
                                    <a href="{% url 'jobs:application_detail' job.pk %}" class="action-btn primary">
                                        <i class="fas fa-calendar"></i>
                                        View Details
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Offer Column -->
                    <div class="pipeline-column">
                        <div class="pipeline-header">
                            <span><i class="fas fa-trophy me-2"></i>Offer</span>
                            <span class="pipeline-count">{{ pipeline.offer.count|default:0 }}</span>
                        </div>
                        <div class="pipeline-items" data-status="offer">
                            {% for job in pipeline.offer %}
                            <div class="job-card pipeline-job-card" data-job-id="{{ job.id }}">
                                <input type="checkbox" name="selected_jobs" value="{{ job.id }}" class="job-checkbox">

                                <h4 class="job-title">
                                    <a href="{% url 'jobs:application_detail' job.pk %}">
                                        {{ job.job_title }}
                                    </a>
                                </h4>

                                <div class="company-info">
                                    <span class="company-name">{{ job.company_name }}</span>
                                </div>

                                {% if job.offer_amount %}
                                <div class="job-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-dollar-sign meta-icon"></i>
                                        <span>${{ job.offer_amount }}</span>
                                    </div>
                                </div>
                                {% endif %}

                                <div class="job-badges">
                                    <span class="job-badge badge-status">Offer Received</span>
                                </div>

                                <div class="job-actions">
                                    <a href="{% url 'jobs:application_detail' job.pk %}" class="action-btn primary">
                                        <i class="fas fa-handshake"></i>
                                        Review Offer
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% else %}
                <!-- Empty State for Pipeline -->
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <h4 class="empty-title">No Applications in Pipeline</h4>
                    <p class="empty-text">
                        Start applying to jobs to see them organized in your application pipeline.
                    </p>
                    <a href="{% url 'jobs:search_config' %}" class="empty-action">
                        <i class="fas fa-rocket"></i>
                        Start Job Search
                    </a>
                </div>
            {% endif %}
        </div>

        <!-- Enhanced Pagination -->
        {% if is_paginated %}
        <div class="pagination-container" style="padding: 2rem; border-top: 1px solid var(--border-primary);">
            <nav aria-label="Job list pagination">
                <ul class="pagination justify-content-center mb-0" style="gap: 0.5rem;">
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                               style="border-radius: 0.5rem; border: 2px solid var(--border-primary); background: var(--bg-primary);">
                                <i class="fas fa-angle-double-left"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                               style="border-radius: 0.5rem; border: 2px solid var(--border-primary); background: var(--bg-primary);">
                                <i class="fas fa-angle-left"></i>
                            </a>
                        </li>
                    {% endif %}

                    <li class="page-item active">
                        <span class="page-link" style="border-radius: 0.5rem; background: var(--job-gradient-1); border: none; color: white;">
                            {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                        </span>
                    </li>

                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                               style="border-radius: 0.5rem; border: 2px solid var(--border-primary); background: var(--bg-primary);">
                                <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                               style="border-radius: 0.5rem; border: 2px solid var(--border-primary); background: var(--bg-primary);">
                                <i class="fas fa-angle-double-right"></i>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
    </div>
</div>

<!-- Enhanced Status Update Modal -->
<div class="modal fade" id="statusUpdateModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 1rem; box-shadow: var(--card-shadow-hover);">
            <div class="modal-header" style="background: var(--job-gradient-1); color: white; border-radius: 1rem 1rem 0 0;">
                <h5 class="modal-title">
                    <i class="fas fa-edit me-2"></i>
                    Update Job Status
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <form id="statusUpdateForm">
                    <input type="hidden" id="jobId" name="job_id">
                    <div class="mb-3">
                        <label class="form-label fw-bold">New Status</label>
                        <select class="modern-select" id="newStatus" name="status" required>
                            <option value="discovered">Discovered</option>
                            <option value="applied">Applied</option>
                            <option value="application_viewed">Application Viewed</option>
                            <option value="first_interview">Interview Scheduled</option>
                            <option value="offer_received">Offer Received</option>
                            <option value="hired">Hired</option>
                            <option value="rejected_automated">Rejected</option>
                            <option value="withdrawn">Withdrawn</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Notes (Optional)</label>
                        <textarea class="modern-input" id="statusNotes" name="notes" rows="4"
                                  placeholder="Add any relevant notes about this status change..."
                                  style="height: auto; resize: vertical;"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="padding: 1.5rem 2rem; border: none;">
                <button type="button" class="action-btn" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="action-btn primary" onclick="saveStatusUpdate()">
                    <i class="fas fa-save"></i>
                    Update Status
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
// View Toggle Functionality
document.querySelectorAll('.view-toggle-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const viewType = this.getAttribute('data-view');

        // Update button states
        document.querySelectorAll('.view-toggle-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        // Update view content
        document.querySelectorAll('.view-content').forEach(content => {
            content.classList.remove('active');
        });

        if (viewType === 'grid') {
            document.getElementById('gridView').classList.add('active');
        } else if (viewType === 'pipeline') {
            document.getElementById('pipelineView').classList.add('active');
        }

        // Save preference to localStorage
        localStorage.setItem('preferredJobView', viewType);
    });
});

// Load saved view preference
document.addEventListener('DOMContentLoaded', function() {
    const savedView = localStorage.getItem('preferredJobView');
    if (savedView && savedView !== 'grid') {
        const viewBtn = document.querySelector(`[data-view="${savedView}"]`);
        if (viewBtn) {
            viewBtn.click();
        }
    }
});

// Enhanced select all functionality
document.getElementById('selectAll').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.job-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
    });
    updateBulkActions();
});

// Individual checkbox handling
document.querySelectorAll('.job-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        updateBulkActions();

        // Update select all state
        const total = document.querySelectorAll('.job-checkbox').length;
        const selected = document.querySelectorAll('.job-checkbox:checked').length;
        const selectAll = document.getElementById('selectAll');

        selectAll.checked = selected === total;
        selectAll.indeterminate = selected > 0 && selected < total;
    });
});

// Update bulk actions visibility and count
function updateBulkActions() {
    const selected = document.querySelectorAll('.job-checkbox:checked').length;
    const bulkActions = document.getElementById('bulkActions');
    const selectedCount = document.getElementById('selectedCount');
    const executeButton = document.getElementById('executeButton');
    const action = document.getElementById('bulkAction').value;

    selectedCount.textContent = selected;

    if (selected > 0) {
        bulkActions.classList.add('active');
    } else {
        bulkActions.classList.remove('active');
    }

    executeButton.disabled = selected === 0 || !action;
}

// Bulk action dropdown change
document.getElementById('bulkAction').addEventListener('change', updateBulkActions);

// Sort button functionality - improved version with better parameter handling
document.querySelectorAll('.sort-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        // Update active state
        document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        // Get current URL parameters
        const urlParams = new URLSearchParams(window.location.search);

        // Set sort parameter
        urlParams.set('sort', this.dataset.sort);

        // Navigate to new URL preserving all filters
        const newUrl = window.location.pathname + '?' + urlParams.toString();
        window.location.href = newUrl;
    });
});

// Initialize sort buttons on page load
document.addEventListener('DOMContentLoaded', function() {
    // Set active sort button based on URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const currentSort = urlParams.get('sort') || '-created_at';

    document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.sort === currentSort) {
            btn.classList.add('active');
        }
    });
});

// Auto-submit filter form on change
document.getElementById('filterForm').addEventListener('change', function() {
    this.submit();
});

// Enhanced Quick Actions with better styling
function markAsApplied(jobId) {
    Swal.fire({
        title: 'Apply to this job?',
        text: 'This will mark the application as applied and start tracking.',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Yes, Apply!',
        cancelButtonText: 'Cancel',
        customClass: {
            popup: 'swal-custom',
            confirmButton: 'swal-confirm',
            cancelButton: 'swal-cancel'
        },
        buttonsStyling: false
    }).then((result) => {
        if (result.isConfirmed) {
            updateJobStatus(jobId, 'applied');
        }
    });
}

function sendFollowup(jobId) {
    Swal.fire({
        title: 'Send Follow-up?',
        text: 'This will send a follow-up email using your template.',
        icon: 'info',
        showCancelButton: true,
        confirmButtonText: 'Send Follow-up',
        cancelButtonText: 'Cancel',
        customClass: {
            popup: 'swal-custom',
            confirmButton: 'swal-confirm',
            cancelButton: 'swal-cancel'
        },
        buttonsStyling: false
    }).then((result) => {
        if (result.isConfirmed) {
            // Show loading
            Swal.fire({
                title: 'Sending...',
                text: 'Please wait while we send your follow-up email.',
                allowOutsideClick: false,
                showConfirmButton: false,
                willOpen: () => {
                    Swal.showLoading();
                },
                customClass: {
                    popup: 'swal-custom'
                }
            });

            // Simulate API call
            setTimeout(() => {
                Swal.fire({
                    title: 'Success!',
                    text: 'Follow-up email sent successfully.',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false,
                    customClass: {
                        popup: 'swal-custom'
                    }
                });
            }, 2000);
        }
    });
}

function updateStatus(jobId) {
    document.getElementById('jobId').value = jobId;
    const modal = new bootstrap.Modal(document.getElementById('statusUpdateModal'));
    modal.show();
}

function saveStatusUpdate() {
    const jobId = document.getElementById('jobId').value;
    const status = document.getElementById('newStatus').value;
    const notes = document.getElementById('statusNotes').value;

    updateJobStatus(jobId, status, notes);

    const modal = bootstrap.Modal.getInstance(document.getElementById('statusUpdateModal'));
    modal.hide();
}

function updateJobStatus(jobId, status, notes = '') {
    // Simulate API call with proper feedback
    Swal.fire({
        title: 'Updating...',
        text: 'Please wait while we update the job status.',
        allowOutsideClick: false,
        showConfirmButton: false,
        willOpen: () => {
            Swal.showLoading();
        },
        customClass: {
            popup: 'swal-custom'
        }
    });

    // Simulate delay
    setTimeout(() => {
        Swal.fire({
            title: 'Updated!',
            text: 'Job status has been updated successfully.',
            icon: 'success',
            timer: 2000,
            showConfirmButton: false,
            customClass: {
                popup: 'swal-custom'
            }
        });

        // Update the UI
        setTimeout(() => {
            location.reload();
        }, 1000);
    }, 1500);
}

// Bulk form submission with confirmation
document.getElementById('bulkForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const selected = document.querySelectorAll('.job-checkbox:checked').length;
    const action = document.getElementById('bulkAction').value;

    if (selected === 0) {
        Swal.fire({
            title: 'No Selection',
            text: 'Please select at least one job application.',
            icon: 'warning',
            customClass: {
                popup: 'swal-custom'
            }
        });
        return;
    }

    if (!action) {
        Swal.fire({
            title: 'No Action Selected',
            text: 'Please choose an action to perform.',
            icon: 'warning',
            customClass: {
                popup: 'swal-custom'
            }
        });
        return;
    }

    const actionText = document.getElementById('bulkAction').selectedOptions[0].text;

    Swal.fire({
        title: `${actionText}?`,
        text: `This will ${actionText.toLowerCase()} for ${selected} selected jobs.`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Proceed',
        cancelButtonText: 'Cancel',
        customClass: {
            popup: 'swal-custom',
            confirmButton: 'swal-confirm',
            cancelButton: 'swal-cancel'
        },
        buttonsStyling: false
    }).then((result) => {
        if (result.isConfirmed) {
            this.submit();
        }
    });
});

// Enhanced SweetAlert2 styling
const swalStyle = document.createElement('style');
swalStyle.innerHTML = `
    .swal-custom {
        border-radius: 1rem !important;
        box-shadow: var(--card-shadow-hover) !important;
    }

    .swal-confirm {
        background: var(--job-gradient-1) !important;
        color: white !important;
        border: none !important;
        border-radius: 0.75rem !important;
        padding: 0.75rem 1.5rem !important;
        font-weight: 600 !important;
        margin: 0 0.5rem !important;
    }

    .swal-cancel {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
        border: 2px solid var(--border-primary) !important;
        border-radius: 0.75rem !important;
        padding: 0.75rem 1.5rem !important;
        font-weight: 600 !important;
        margin: 0 0.5rem !important;
    }

    .swal2-styled:focus {
        box-shadow: none !important;
    }
`;
document.head.appendChild(swalStyle);

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    updateBulkActions();
});

// Drag and Drop for Pipeline View (Advanced Feature)
let draggedElement = null;

function initializeDragAndDrop() {
    document.querySelectorAll('.pipeline-job-card').forEach(card => {
        card.setAttribute('draggable', true);

        card.addEventListener('dragstart', function(e) {
            draggedElement = this;
            this.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        });

        card.addEventListener('dragend', function(e) {
            this.style.opacity = '';
            draggedElement = null;
        });
    });

    document.querySelectorAll('.pipeline-items').forEach(column => {
        column.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            this.style.background = 'rgba(102, 126, 234, 0.1)';
        });

        column.addEventListener('dragleave', function(e) {
            this.style.background = '';
        });

        column.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.background = '';

            if (draggedElement) {
                const jobId = draggedElement.getAttribute('data-job-id');
                const newStatus = this.getAttribute('data-status');

                // Move the element visually
                this.appendChild(draggedElement);

                // Update status in backend
                updateJobStatus(jobId, newStatus);

                // Update pipeline counts
                updatePipelineCounts();
            }
        });
    });
}

function updatePipelineCounts() {
    document.querySelectorAll('.pipeline-column').forEach(column => {
        const items = column.querySelectorAll('.pipeline-job-card').length;
        const countElement = column.querySelector('.pipeline-count');
        if (countElement) {
            countElement.textContent = items;
        }
    });
}

// Initialize drag and drop when pipeline view is active
const pipelineViewObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            const pipelineView = document.getElementById('pipelineView');
            if (pipelineView && pipelineView.classList.contains('active')) {
                setTimeout(initializeDragAndDrop, 100);
            }
        }
    });
});

// Observe pipeline view for changes
const pipelineView = document.getElementById('pipelineView');
if (pipelineView) {
    pipelineViewObserver.observe(pipelineView, {
        attributes: true,
        attributeFilter: ['class']
    });
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + F for focus search
    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        e.preventDefault();
        const searchInput = document.querySelector('.search-input');
        if (searchInput) {
            searchInput.focus();
        }
    }

    // Ctrl/Cmd + A for select all
    if ((e.ctrlKey || e.metaKey) && e.key === 'a' && e.target.tagName !== 'INPUT') {
        e.preventDefault();
        const selectAll = document.getElementById('selectAll');
        if (selectAll) {
            selectAll.checked = !selectAll.checked;
            selectAll.dispatchEvent(new Event('change'));
        }
    }

    // Tab keys for view switching
    if (e.key === '1' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        document.querySelector('[data-view="grid"]').click();
    }

    if (e.key === '2' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        document.querySelector('[data-view="pipeline"]').click();
    }
});

// Real-time search (debounced)
let searchTimeout;
const searchInput = document.querySelector('.search-input');
if (searchInput) {
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            // Only submit if user has stopped typing for 500ms
            if (this.value.length >= 3 || this.value.length === 0) {
                document.getElementById('filterForm').submit();
            }
        }, 500);
    });
}

// Auto-refresh functionality (optional)
let autoRefreshInterval;
function toggleAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
    } else {
        autoRefreshInterval = setInterval(() => {
            // Only refresh if no modals are open and no form interactions
            const hasOpenModal = document.querySelector('.modal.show');
            const hasActiveInput = document.activeElement.tagName === 'INPUT' ||
                                 document.activeElement.tagName === 'SELECT' ||
                                 document.activeElement.tagName === 'TEXTAREA';

            if (!hasOpenModal && !hasActiveInput) {
                // Perform a silent refresh of job data
                fetch(window.location.href + '?ajax=1')
                    .then(response => response.json())
                    .then(data => {
                        // Update stats if provided
                        if (data.stats) {
                            updateStatsDisplay(data.stats);
                        }
                    })
                    .catch(console.error);
            }
        }, 30000); // Refresh every 30 seconds
    }
}

function updateStatsDisplay(stats) {
    const statsNumbers = document.querySelectorAll('.stats-number');
    if (statsNumbers[0] && stats.total) statsNumbers[0].textContent = stats.total;
    if (statsNumbers[1] && stats.applied) statsNumbers[1].textContent = stats.applied;
    if (statsNumbers[2] && stats.interviews) statsNumbers[2].textContent = stats.interviews;
    if (statsNumbers[3] && stats.offers) statsNumbers[3].textContent = stats.offers;
}

// Touch gesture support for mobile
let touchStartX = 0;
let touchStartY = 0;

document.addEventListener('touchstart', function(e) {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
});

document.addEventListener('touchend', function(e) {
    if (!touchStartX || !touchStartY) return;

    const touchEndX = e.changedTouches[0].clientX;
    const touchEndY = e.changedTouches[0].clientY;

    const diffX = touchStartX - touchEndX;
    const diffY = touchStartY - touchEndY;

    // Swipe left/right to change views (only if vertical swipe is minimal)
    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        const currentView = document.querySelector('.view-toggle-btn.active').getAttribute('data-view');

        if (diffX > 0 && currentView === 'grid') {
            // Swipe left: grid to pipeline
            document.querySelector('[data-view="pipeline"]').click();
        } else if (diffX < 0 && currentView === 'pipeline') {
            // Swipe right: pipeline to grid
            document.querySelector('[data-view="grid"]').click();
        }
    }

    touchStartX = 0;
    touchStartY = 0;
});

// Performance optimization: Lazy loading for large lists
function initializeLazyLoading() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                    observer.unobserve(img);
                }
            }
        });
    });

    document.querySelectorAll('img[data-src]').forEach(img => {
        observer.observe(img);
    });
}

// Initialize lazy loading if needed
document.addEventListener('DOMContentLoaded', initializeLazyLoading);

// Accessibility improvements
document.addEventListener('DOMContentLoaded', function() {
    // Add ARIA labels and roles
    document.querySelectorAll('.job-card').forEach((card, index) => {
        card.setAttribute('role', 'article');
        card.setAttribute('aria-label', `Job opportunity ${index + 1}`);
    });

    // Add keyboard navigation for job cards
    document.querySelectorAll('.job-card').forEach(card => {
        card.setAttribute('tabindex', '0');
        card.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                const link = this.querySelector('.job-title a');
                if (link) link.click();
            }
        });
    });

    // Announce view changes to screen readers
    const viewToggleButtons = document.querySelectorAll('.view-toggle-btn');
    viewToggleButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const viewName = this.getAttribute('data-view');
            const announcement = `Switched to ${viewName} view`;

            // Create and remove an announcement element
            const announcer = document.createElement('div');
            announcer.setAttribute('aria-live', 'polite');
            announcer.setAttribute('aria-atomic', 'true');
            announcer.className = 'sr-only';
            announcer.textContent = announcement;
            document.body.appendChild(announcer);

            setTimeout(() => {
                document.body.removeChild(announcer);
            }, 1000);
        });
    });
});

// Print styles support
const printStyles = document.createElement('style');
printStyles.media = 'print';
printStyles.innerHTML = `
    @media print {
        .view-toggle, .bulk-actions, .filter-card, .job-actions {
            display: none !important;
        }

        .job-card {
            break-inside: avoid;
            margin-bottom: 1rem;
            border: 1px solid #ccc !important;
            background: white !important;
            color: black !important;
        }

        .page-header {
            background: white !important;
            color: black !important;
        }

        .pipeline-view {
            display: block !important;
        }

        .pipeline-column {
            margin-bottom: 2rem;
            border: 1px solid #ccc;
        }
    }
`;
document.head.appendChild(printStyles);

console.log('Job List with working tabs loaded successfully!');
</script>
{% endblock %}